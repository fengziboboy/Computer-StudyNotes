
# 一、数据类型

## varchar类型
1. MySQL 数据库的varchar类型在4.1以下的版本中的最大长度限制为255，其数据范围可以是0~255或1~255（根据不同版本数据库来定）。在**MySQL5.0以上**的版本中，varchar数据类型的长度支持到了**65535**，也就是说可以存放65532个字节的数据，起始位和结束位占去了3个字 节。
   >也就是说，在4.1或以下版本中需要使用固定的TEXT或BLOB格式存放的数据可以使用可变长的varchar来存放，这样就能有效的减少数据库文 件的大小。

### 1.varchar类型的变化
- 4.0版本以下，varchar(20)，指的是20字节，如果存放UTF8汉字时，只能存6个（每个汉字3字节） ；
- 5.0版本以上，varchar(20)，指的是20字符，无论存放的是数字、字母还是UTF8汉字（每个汉字3字节），都可以存放20个，最大大小是 65532字节 ；
- varchar(20)在Mysql4中最大也不过是20个字节,但是Mysql5根据编码不同,存储大小也不同，具体有以下规则：

1. 存储限制
>varchar 字段是将实际内容单独存储在聚簇索引之外，实际存储从第二个字节开始，接着要用1到2个字节表示实际长度（长度超过255时需要2个字节），因此`最大长度`不能超过`65535`。
2. 编码长度限制
   1. 字符类型若为gbk，每个字符最多占2个字节
   2. 字符类型若为utf8，每个字符最多占3个字节
   3. 若定义的时候超过上述限制，则`varchar`字段会被**强行转**为`text`类型，并产生`warning`。
3. 行长度限制
>导致实际应用中varchar长度限制的是一个行定义的长度。 MySQL要求一个行的定义长度不能超过65535。若定义的表长度超过这个值，则提示
```log
ERROR 1118 (42000): Row size too large. The maximum row size for the used table type, not counting BLOBs, is 65535. You have to change some columns to TEXT or BLOBs。
```

### 2. CHAR(M), VARCHAR(M)不同之处

- **CHAR(M)**定义的**列的长度为固定的**，M取值可以为0～255之间，当保存CHAR值时，在它们的**右边填充空格**以达到指定的长度。
   - 当检索到CHAR值时，尾部的空格被删除掉。
   - 在存储或检索过程中不进行大小写转换。
   - CHAR存储定长数据很方便，CHAR字段上的索引效率级高，比如定义 char(10)，那么不论你存储的数据是否达到了10个字节，都要占去10个字节的空间,不足的自动用空格填充。

- **VARCHAR(M)**定义的列的长度为**可变长字符串**，M取值可以为0~65535之间，(VARCHAR的**最大有效长度**由**最大行大小**和使用的**字符集**确定。
  - 整体最大长度是65,532字节）。
  - VARCHAR值保存时只保存需要的字符数，另加一个**字节来记录长度**(如果列声明的长度超过255，则使用**两个字节**)。
  - VARCHAR值保存时不进行填充。当值保存和检索时尾部的空格仍保留，符合标准SQL。

- **对比**
  - 存储变长数据，但存储效率没有CHAR高。
  - 如果一个字段可能的值是不固定长度的，我们只知道它不可能超过10个字符，把它定义为 VARCHAR(10)是最合算的。
  - VARCHAR类型的实际长度是它的值的实际长度+1。为什么"+1"呢？这一个字节用于保存实际使用了多大的长度。 
  - 从空间上考虑，用varchar合适；
  - 从效率上考虑，用char合适，关键是根据实际情况找到权衡点。

- 如果分配给CHAR或VARCHAR列的值超过列的最大长度，则对值进行裁剪以使其适合。如果被裁掉的字符不是空格，则会产生一条警告。如果裁剪非空格字符，则会造成错误(而不是警告)并通过使用严格SQL模式禁用值的插入。

### VARCHAR/TEXT/BLOB类型的区别
- BLOB和TEXT类型需要1，2，3或4个字节来记录列值的长度，这取决于类型的最大可能长度。VARCHAR需要定义大小，有65535字节的最大限制；TEXT则不需要。如果你把一个超过列类型最大长度的值赋给一个BLOB或TEXT列，值被截断以适合它。

- 一个BLOB是一个能保存可变数量的数据的二进制的大对象。4个BLOB类型TINYBLOB、BLOB、MEDIUMBLOB和LONGBLOB仅仅在他们能保存值的最大长度方面有所不同。

- BLOB 可以储存图片,TEXT不行，TEXT只能储存纯文本文件。
- 4个TEXT类型TINYTEXT、TEXT、MEDIUMTEXT和LONGTEXT对应于 4个BLOB类型，并且有同样的最大长度和存储需求。
- 在BLOB和TEXT类型之间的唯一差别是对BLOB值的排序和比较以大小写敏感方式执行，而对 TEXT值是大小写不敏感的。换句话说，一个TEXT是一个大小写不敏感的BLOB。

- 如果遇到了大文本，考虑使用text，最大能到4G。

* 效率来说基本是char>varchar>text，但是如果使用的是Innodb引擎的话，推荐使用varchar代替char

* char和varchar可以有默认值，text不能指定默认值