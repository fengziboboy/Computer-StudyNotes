[TOC]
# 快投平台普通版需求MRD
## 1. 背景
**不足**：
- 发现交互操作不流畅，部分功能的使用频率较低；
- 在引入新客户的过程中，发现现有投放流程对大部分普通客户来说复杂度较高、不易于理解，对客户投放造成了一定阻碍。
 
**改进**：
- 优化现有界面交互、投放流程；
- 并推出快投基础版供初阶用户使用，降低客户投放门槛；
- 将更多复杂功能以小流量的方式向高阶客户提供，满足客户的特殊诉求。
- 快投用户就已经是小流量用户了。然后针对快投用户又要分为有商品集合的大客户和无商品集合的普通用户。
**我的理解**：
- 快投系统优化成普通版（没有商品集合的）和大客户（有商品集合）。不同客户用小流量账户区分，功能有区分。
- 优化一些操作，增加一些功能，并且对用户进行区分后，功能是根据用户类型有区别的。

## 2. 商品文件投放
- 引导普通用户使用商品文件（feed）进行投放；
- 将商品集合功能改为账户小流量，相关功能仅小流量用户可见；
- 商品集合小流量用户：后续提供。

### 2.1 顶部导航调整 
当前顶部导航： 
- 【投放单元】 | 【商品集合】

修改后的顶导：
- 针对有商品集合的大客户 
  - 【投放单元】 | 【商品集合】 | 【数据报告】 | 【商品库】
- 针对无商品集合的普通散户
  - 【投放单元】 | 【数据报告】 | 【商品库】
<div align=center><img src="..\配图\项目图\1.快投普通版需求-顶导调整.png"></div>
<div align=center style="margin-bottom:10px;">图1.顶导示意图</div>
    
>也就是,首先增加跳转【数据报告】 | 【商品库】的入口导航，并且对普通用户取消掉【商品集合】的导航。

其中跳转具体需求：
- 【数据报告】——>【旭日平台-数据报告-快投数据报告-高级样式报告】 （赵锦波负责）
- 【商品库】——>【商品库-首页】 （赵锦波负责）
- 【商品集合】仅商品集合小流量名单中用户（就是那些大客户）可见。


### 2.2 新建投放单元页面修改
当前选项有：
  - 投放单元名称【必填】
  - 商品集合【必填】
  - 设置监控代码
  - 以及右侧有个按钮【新建商品集合】可拉出一个抽屉页面新建商品集合。

<div align=center><img src="..\配图\项目图\2.快投普通版需求-新建投放单元页面.png"></div>
<div align=center style="margin-bottom:10px;">2.新建投放单元页面示意图</div>

修改后选项：
- 针对**非**商品集合的快投用户：
  - 投放单元名称【必填】
  - 商品文件【必填】（新增）
    >用户单击后下拉菜单展示所有商品库中已对接商品文件（feed）的名称，仅支持单选。还有问号提示语文字：_商品文件是包含商品数据的文件，可应用于广告投放，需通过商品库进行提交_
  - 设置监控代码
  - 右侧【**新建商品集合**】不变，**新增**【**新建商品文件**】按钮。
    >单击【**新建商品文件**】按钮跳转到商品库-商品文件首页。
- 针对**商品集合**的快投用户：
  - 投放单元名称【必填】
  - 商品文件【必填】（新增）
    >用户单击后下拉菜单展示所有商品库中已对接商品文件（feed）的名称，仅支持单选。还有问号提示语文字：_商品文件是包含商品数据的文件，可应用于广告投放，需通过商品库进行提交_
  - 商品集合
    >注意，商品集合改成了选填。用户选中某**商品文件**后，商品集合下拉菜单中展示该商品文件包含的所有商品集合。
  - 设置监控代码
  - 右侧【**新建商品集合**】不动，**新增**【**新建商品文件**】按钮。
    >单击【新建商品文件】按钮跳转到商品库-商品文件首页。

    	如用户选中某商品集合，则认为该投放单元**绑定此商品集合**并进行投放。
    	如用户**未**选择商品集合，则认为该投放单元**绑定未经筛选的商品文件**进行投放。

### 2.3 投放单元列表优化
<div align=center><img src="..\配图\项目图\3.快投普通版需求-投放单元列表优化.png"></div>
<div align=center style="margin-bottom:10px;">图3.投放单元列表示意图</div>

功能调整：
- 原【**投放商品集合**】表头文字修改为【**投放商品**】。
- **非**商品集合小流量用户，表格内显示： 
  - 商品文件：XXXX 
     >XXXX为具体商品文件名称。
- **商品集合**小流量用户，表格内显示：
  - 商品文件：XXXX 
  - 商品集合:XXXX
    >XXX对应展示商品文件名及商品集合名。

- **新增修改投放商品**按钮（在上面的基础上）
  - 当用户修改投放商品时，弹出框**标题修改**为【修改投放商品】，打开后**显示用户原有选择**，如下图所示。
  <div align=center><img src="..\配图\项目图\4.快投普通版需求-投放单元列表优化-增加修改投放商品功能.png"></div>
    <div align=center style="margin-bottom:10px;">图4.投放单元列表新增修改投放商品（原称投放商品集合）的功能</div>

  - 商品集合小流量用户可见：商品文件、商品集合选择框，产品规则同新建环节。
  - **非**商品集合小流量用户**仅**可见：商品文件选择框，产品规则同新建环节。

## 3. 创意模板设置优化
（赵锦波负责创意模板字段接口修改）
### 3.1 需求概述
- **需求背景**：创意模板设置环节，**均为英文**(见图5)，对部分客户操作造成理解困难。希望在界面上，针对使用不同模板的客户，将英文字段修改为中英文对照字段，以便帮助客户快速完成模板填写。
<div align=center><img src="..\配图\项目图\5.快投普通版需求-投放单元列表优化-创意模板设置英文不友好.png"></div>
<div align=center style="margin-bottom:10px;">图5.创意模板设置-英文不友好</div>


- **优化方案**：**中英文显示**，如下图。
<div align=center><img src="..\配图\项目图\6.快投普通版需求-投放单元列表优化-创意模板设置中英文优化.png"></div>
<div align=center style="margin-bottom:10px;">图5.创意模板设置-优化成中英文显示</div>

### 3.2 字段中英文对照规则 

通用模板：使用EXCEL通用模板字段中英文对照规则
教育模板：使用EXCEL教育模板字段中英文对照规则
招商模板：使用EXCEL招商模板字段中英文对照规则

---

# 批量添加账户的excel错误处理逻辑
1. 读入一个excel表（只支持2007及以上的版本 .xlsx为后缀的）一行行数据解析。
2. 首先是该次excel中的数据内部进行比较检查：（如果导入excel按照规则不乱来，则下面的都可以忽略不管....）
   1. 如果出现字段错误：字段为空或者厂商类型、平台版本不在规定列表中。 ——>  则仅丢弃该行数据，前端不提示，后台会打日志，真要排查可以通过日志但比较麻烦。
   2. ID和主账号必须为整数（出现文字符号或者带小数点都不行，此规则违反会直接报错，整个表格插入失败--也可以改成只是丢弃该行）
   3. 如果一个账号ID重复出现，则以第一次插入为准，后面再出现会被忽略。
   4. 如果账号主账号ID在两个不同的集团（以客户名称唯一标识一个集团，不同客户名称属于不同集团），以第一个为准，后面再出现的插入整行忽略。 
   5. 如果同一集团（客户名称）出现不同的主账户或平台版本，因为无法判定哪个是想要的，所以该集团下的所有账号添加失败。
3. 然后，再跟数据库已存在数据进行比较：
   1. 若某账号已存在，则该账号所属集团的所有账号添加失败。
   2. 若集团名称已存在，则该集团下的所有账号添加失败。
    > 手动添加或修改，出现重复会报错，目前是判断名称和ID重复合在一起，提示：“该集团名称或账号集已存在，插入/更新失败！”
