# 单元测试
[TOC]

# 定义
维基百科的解释：
>单元测试（英语：Unit Testing）又称为模块测试，是针对程序模块)（软件设计的最小单位）来进行正确性检验的测试工作。程序单元是应用的最小可测试部件。在过程化编程中，一个单元就是单个程序、函数、过程等；对于面向对象编程，最小单元就是方法，包括基类（超类）、抽象类、或者派生类（子类）中的方法。

# 好处
单元测试的好处包括但不限于：

- **提升软件质量**
    优质的单元测试可以保障开发质量和程序的鲁棒性。越早发现的缺陷，其修复的成本越低。

- **促进代码优化**
    单元测试的编写者和维护者都是开发工程师，在这个过程当中开发人员会不断去审视自己的代码，从而（潜意识）去优化自己的代码。

- **提升研发效率**
    编写单元测试，表面上是占用了项目研发时间，但是在后续的联调、集成、回归测试阶段，单测覆盖率高的代码缺陷少、问题已修复，有助于提升整体的研发效率。

- **增加重构自信**
    代码的重构一般会涉及较为底层的改动，比如修改底层的数据结构等，上层服务经常会受到影响；在有单元测试的保障下，我们对重构出来的代码会多一份底气。

# 单元测试的基本原则
宏观上，单元测试要符合 AIR 原则：
* A: Automatic（自动化）
* I: Independent（独立性）
* R: Repeatable（可重复）

微观上，单元测试代码层面要符合 BCDE 原则：
* B: Border，边界性测试，包括循环边界、特殊取值、特殊时间点、数据顺序等
* C: Correct，正确的输入，并且得到预期的结果**
* D: Design，与设计文档相符合，来编写单元测试
* E: Error，单元测试的目的是为了证明程序有错，而不是证明程序无错。
    >为了发现代码中潜藏的错误，我们需要在编写测试用例时有一些强制的错误输入（如非法数据、异常流程、非业务允许输入等）来得到预期的错误结果。

# 单元测试的常见场景
1. 开发前写单元测试，通过测试描述需求，由测试驱动开发。（如果不熟悉TDD的同学可以去google一下）
2. 在开发过程中及时得到反馈，提前发现问题。
3. 应用于自动化构建或持续集成流程，对每次代码修改做回归测试。（CI/CD 质量保障）
4. 作为重构的基础，验证重构是否可靠。

# 单元测试的常见痛点
下列痛点是日常开发中可能会遇到的，

1. 测试上下文依赖外部服务（如数据库服务）
2. 测试上下文存在代码依赖（如框架等）
3. 单元测试难以维护和理解（语义不清）
4. 对于多场景不同输入输出的函数，单元测试代码量会很多
5. 需要连接一些微服务
...