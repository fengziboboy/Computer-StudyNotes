# Kafka入门指南

## 简单认识下

## 概念名词解释
Kafka 是一个**分布式**的，**支持多分区、多副本**，基于**Zookeeper** 的分布式**消息流**平台，它同时也是一款开源的基于**发布订阅**模式的**消息引擎**系统。

- **消息**：Kafka 中的数据单元被称为消息
- **主题**：消息的种类称为 主题（Topic），相当于是对消息进行分类
- **分区**：主题可以被分为若干个分区（partition）
  - 同一个主题中的分区可以不在一个机器上，有可能会部署在多个机器上，由此来实现 kafka 的伸缩性，
  - 单一主题中的分区有序，但是无法保证主题中所有的分区有序
- **生产者**： 向主题发布消息的**客户端**应用程序称为生产者（Producer），生产者用于持续不断的向某个主题发送消息
- **消费者**：订阅主题消息的**客户端**程序称为消费者（Consumer），消费者用于处理生产者产生的消息。
  - **消费者群组**：生产者与消费者的关系就如同餐厅中的厨师和顾客之间的关系一样，一个厨师对应多个顾客，也就是一个生产者对应多个消费者，消费者群组（Consumer Group）指的就是由一个或多个消费者组成的群体。
- **偏移量**：偏移量（Consumer Offset）是一种元数据，它是一个不断递增的整数值，用来记录消费者发生**重平衡**时的位置，以便用来恢复数据。
  - **重平衡**：Rebalance。消费者组内某个消费者实例挂掉后，其他消费者实例自动重新分配订阅主题分区的过程。Rebalance 是 Kafka 消费者端实现高可用的重要手段。
  
- **broker**: 一个独立的 Kafka 服务器就被称为 broker，broker 接收来自生产者的消息，为消息设置偏移量，并提交消息到磁盘保存。Kafka 的**服务器端**。
  - **broker 集群**：broker 是集群 的组成部分，broker 集群由一个或多个 broker 组成，每个集群都有一个 broker 同时充当了集群控制器的角色（自动从集群的活跃成员中选举出来）。
- **副本**：Kafka 中消息的备份又叫做 副本（Replica），副本的数量是可以配置的，Kafka 定义了两类副本：领导者副本（Leader Replica） 和 追随者副本（Follower Replica），前者对外提供服务，后者只是被动跟随。
>生产者总是向领导者副本写消息;而消费者总是从领导者副本读消息。至于追随者副本，它只做一件事:向领导者副本发送请求，请求领导者把最新生产的消息发给它，这样它能保持与领导者的同步。



### 特性

- `高吞吐、低延迟`：kakfa 最大的特点就是收发消息非常快，kafka 每秒可以处理几十万条消息，它的最低延迟只有几毫秒。
- `高伸缩性`： 每个主题(topic) 包含多个分区(partition)，主题中的分区可以分布在不同的主机(broker)中。
- `持久性、可靠性`： Kafka 能够允许数据的持久化存储，消息被持久化到磁盘，并支持数据备份防止数据丢失，Kafka 底层的数据存储是基于 Zookeeper 存储的，Zookeeper 我们知道它的数据能够持久存储。
- `容错性`： 允许集群中的节点失败，某个节点宕机，Kafka 集群能够正常工作. 
  
- `高并发`： 支持数千个客户端同时读写.

**问：Kafka为什么快？高吞吐？**
* 顺序读写
* 零拷贝
* 消息压缩
* 分批发送


**问： Kafka Broker 是如何持久化数据的？**

Kafka 使用 消息日志(Log)来保存数据，一个日志就是磁盘上一个只能追加写(Append-only)消 息的物理文件。
>因为只能追加写入，故避免了缓慢的随机 I/O 操作，改为性能较好的顺序 I/O 写操作，这也是实现 Kafka 高吞吐量特性的一个重要手段。


**问：Kafka定期删除数据回收磁盘，怎么删除呢？**

**通过日志段(Log Segment)机制**。在 Kafka 底层，一 个日志又近一步细分成多个日志段，消息被追加写到当前最新的日志段中，当写满了一个日 志段后，Kafka 会自动切分出一个新的日志段，并将老的日志段封存起来。

Kafka 在后台还 有**定时任务会定期地检查**老的日志段**是否能够被删除**，从而实现回收磁盘空间的目的。


**再说说消费者**




### 使用场景

### 对比


# 参考资料


作者：程序员cxuan
链接：https://juejin.im/post/6844903495670169607
来源：掘金

