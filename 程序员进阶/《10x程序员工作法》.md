

## 测试


### 为什么写不好测试？

* 开发者应该写测试；
* 要写可测的代码；
* 要想做好TDD，先要做好任务分解。


**为什么你的测试不够好呢？**

主要是因为这些测试不够简单。只有将复杂的测试拆分成简单的测试，测试才有可能做好。


**简单的测试**

把测试写简单，简单到一目了然，不需要证明它的正确性。所以，如果你见到哪个测试写得很复杂，它一定不是一个好的测试。


**前置准备、执行、断言和清理**

- 的核心是中间的执行部分，它就是测试的目标，但实际上，它往往也是最短小的，
一般就是一行代码调用。

- 前置准备，就是准备执行部分所需的依赖。比如，一个类所依赖的组件，或是调用方法所
需要的参数。

- 断言是我们的预期，就是这段代码执行出来怎么算是对的。

- 清理是一个可能会有的部分，如果你的测试用到任何资源，都可以在这里释放掉。


### 测试的坏味道

- 测试里做的事情太多，出现了几个不同方法的调用，这会导致不知道测试谁，一旦出错，就需要把所有相关的几个方法都查看一遍，这无疑是增加了工作的复杂度。
  > 多写几个测试就好了

- 测试一定要有断言。
- 复杂。
  - 当你看到测试代码里出现各种判断和循环语句，基本上这个测试就有问题了。
  >多写几个测试，每个测试覆盖一种场景。


#### 怎么样的测试算好的测试? 一段旅程（A-TRIP）

- **Automatic，自动化**: 把测试尽可能交给机器执行，人工参与的部分越少越好。
  - 测试一定要有断言的原因，因为一个测试只有在有断言的情况下，机器才能自动地判断测试是否成功。

- **Thorough，全面的**: 应该尽可能用测试覆盖各种场景。
  - 在写代码之前，要考虑各种场景：正常的、异常的、各种边界条件
  - 写完代码之后，我们要看测试是否覆盖了所有的代码和所有的分支，这就是各种测试覆盖率工具发挥作用的场景了。
  
- **Repeatable，可重复的**：
  - 某一个测试反复运行，结果应该是一样的，每一个测试本身都不应该依赖于任何不在控制之下的环境。
  - 一堆测试反复运行，结果应该是一样的。这说明测试和测试之间没有任何依赖

- **Independent，独立的**：测试和测试之间不应该有任何依赖。
  - 什么叫有依赖？比如，如果测试依赖于外部数据库或是第三方服务，测试 A 在运行时在数据库里写了一些值，测试 B要用到数据库里的这些值，测试 B 必须在测试 A 之后运行，这就叫有依赖。
  - 减少外部依赖可以用 mock，实在要依赖，每个测试自己负责前置准备和后续清理。

- **Professional，专业的** ： 测试代码，也是代码，也要按照代码的标准去维护。
  - 这就意味着你的测试代码也要写得清晰，比如：良好的命名，把函数写小，要重构，甚至要抽象出测试的基础库


>编写可测试的代码。
很多人写不好测试，或者觉得测试难写，关键就在于，你始终是站在写代码的视角，而不是写测试的视角。


**要想写好测试，就要写简单的测试。**


- 测试人员的测试会带着破坏的性质，开发人员总是认为一切操作都是合理的。
- 开发常常潜意识的里只会考虑正常的情况，比如输入姓名的input，只会输入不超过三个字符的长度，到测试
手中，会输入一长串，因为程序中没有做长度检查，超过数据库字段长度成都就挂了。



## 程序员也可以砍需求


